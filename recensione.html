

<div class="modal-header">
    <h4 class="modal-title">Lascia una recensione</h4>
    <button type="button" class="close" data-dismiss="modal">&times;</button>
</div>
<div class="modal-body">
    <div id="form">
        <form class="form-form" id="recensione_form" action="recensione.php" method="POST" onsubmit="real_submit(submit)">
            <label class="login-label-secondo">Tua email</label><br>
            <input class="form-input" name="from_rec" id="from_rec"></input><br>
            <label class="login-label-secondo">Nome destinatario</label><br>
            <input class="form-input" name="to_rec"></input><br>
            <label class="login-label-secondo">Recensione</label><br>
            <textarea class="form-input" name="recensione_i" rows="10" cols="30"></textarea><br>
            <label class="login-label-secondo">Punteggio</label><br>
            <select name="score" id="score" title="valutazione">
                <option value="5">5</option>
                <option value="4">4</option>
                <option value="3">3</option>
                <option value="2">2</option>
                <option value="1">1</option>
            </select>

            <input type="submit" style="display: none;" name="recensione_button"></input>
        </form>
    </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal" onclick="remove()">Close</button>
    <button type="button" class="btn btn-default" type="submit" onclick="fake_submit();" id="fake">Invia</button>
</div>
<script>
    $(document).ready(function(){
        $("#score").selectpicker();
        
    });
    function remove() {
        alert("rimuovo tutto");
        $("#recensione_form").reset(); 
    }
    function fake_submit(){
        $('#fake').disabled=true;
        $(document).ready(function(){
            $("#recensione_form").submit();
        }); 
        $('#fake').disabled=false;
    };

    function real_submit(event){
        $(document).ready(function(){
            validateLForm()
        }); 
        event.preventDefault();
    };

    function validateLForm() {
    var from = $("#from_rec").val();
    var to = $("#to_rec").val();
    var rec = $("recensione_i").val();
    
    var punteggio = $("#score").val().length;  

    if (from == "" || to == "" || rec == "" || punteggio<1) {
      alert("compila tutti i campi obligatori");
    }
    else{
        var frm = $('#recensione_form');
        //document.forms["locale_form"].submit();
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            success: function (data) {
                $('form').remove();
                $('.modal-body').append(document.createElement("p").innerHTML = data);
                $(".modal-body").css('background', 'green');
                $('#rec_modal').modal('show');
                $("#recensione_form").submit();
                console.log(data);
            },
            error: function (data) {
                $('.form').remove();
                $('.modal-body').append(document.createElement("p").innerHTML = data);
                $(".modal-body").css('background', 'red');
                $('#rec_modal').modal('show');
                $("#recensione_form").submit();
                console.log(data);
            },
        });
    }
}
</script>
</html>